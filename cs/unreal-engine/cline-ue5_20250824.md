
# CS「cline-ue5」

- 2025-08-24 02:43:26

## 入門メモ

- Cline＋qwen2.5-coder-32bでClineMemoryBankを初期化しようとすると12491トークン使ってContext Length不足で怒られる。
- 一応LM Studioの設定からトークン上限は変えられるけど、GPT曰くRTX4090でも4096トークンが限界ぽい。
- もう少し軽いモデルを使うかあ。
- Planは軽いモデルに、Actは精度の高いモデルにやってもらうのがよさそう

| Context Length | VRAM 目安  | 備考                     |
| -------------- | -------- | ---------------------- |
| 4,096          | 約24–28GB | 標準設定、推論は高速             |
| 8,192          | 約40–48GB | 4096の2倍のメモリ、遅延増加       |
| 16,384         | 約70–80GB | 大量履歴保持、RTX4090でもやや余裕なし |
| 32,768         | 120GB以上  | 通常の単GPUでは不可能、分割・量子化必須  |


### LyraStarterGameのFPSを調整したいのに神経衰弱のメモリバンクになっているため修正

↓修正前

```md:
## projectbrief.md

```javascript
このプロジェクトは、Clineがシンプルな記憶ゲームを開発するソフトウェア開発タスクです。このタスクの目的は、ユーザーの視覚的認識能力と短期記憶スキルを刺激し、ユーザーに魅力的でインタラクティブな体験を提供することです。
```

## productContext.md

```javascript
記憶ゲームの目的は、戦略と運の組み合わせを通じてプレイヤーを楽しませ、挑戦させ、リラックスさせることです。これは、人々が短い脳トレを楽しんだり、空き時間に時間を潰したりできるプラットフォームを提供します。

機能:
- ユーザーインターフェース: ユーザーインターフェースは、清潔でシンプルで直感的なものでなければなりません。
- ゲームメカニクス: プレイヤーは、カードを裏返した後にその位置を記憶し、同じカード同士を一致させることでプレイします。
```

## systemPatterns.md

```javascript
システムパターン:
- MVC（モデル・ビュー・コントローラー）アーキテクチャが採用されています。これにより、データモデル、UI、ロジックの役割が分離されます。

デザインパターン:
- シングルトン: クラスのインスタンスが1つだけ存在し、グローバルにアクセス可能にするパターンです。例えば、ゲームの状態を維持するために使用されます。


## techContext.md

```javascript
このプロジェクトでは、ウェブページのインタラクティブ性を実現するためにクライアントサイドのスクリプトとしてJavaScriptを使用しています。ウェブページのコンテンツの構造化にはHTMLが使用され、CSSスタイルはSCSSのようなプリプロセッサを使用して適用され、メンテナンス性とスケーラビリティを向上させています。

ツールの使用パターン:
- Webpack: アセットのバンドルと依存関係の管理に使用されます。
- Babel: 現代のJavaScript機能を現在のブラウザと互換性のある古いバージョンにトランスパイルするため。
```

## activeContext.md

```javascript
最近の変更点:
- ユーザーインターフェースのデザインを、異なる画面サイズでの応答性を向上させるために最適化しました。
- プレイヤーがカードの裏面画像を表示できないようにすることで、不正行為を防止するためのゲーム状態の処理が改善されました。

今後の手順:
- ユーザーがアプリケーション内から直接バグを報告したり、提案を提供できるユーザーフィードバックシステムを実装します。これは、クリックするとゲームバージョンとプレイヤーの現在の状態の詳細が事前入力されたメールクライアントを開くボタンのようなシンプルなものでも構いません。
```

## progress.md

```javascript
機能している点:
- カード反転アニメーションは滑らかで視覚的に魅力的です。

未完了の機能:
- ユーザーフィードバック機能の実装が必要です。これには、ユーザーからのメッセージを自動的に処理できるメールシステムの設定が含まれます。手動での介入や専用サーバーサイドスクリプトの設置を必要としない仕組みが求められます。

現在の状況:
- ゲームのコア機能は実装されていますが、ユーザー体験の向上に向けた改善点がまだ残っています。
```
```

↓修正プロンプト

```md
<attempt_completion>
<result>
- 参照ファイル: projectbrief.md, productContext.md, progress.md
- プロジェクト種類: TPSゲーム（記憶ゲームではない）
- 使用サンプル: LyraStarterGameディレクトリのプロジェクト
- 改修対象: SHOOTER GYM/CONTROL 内の射撃練習モード
- 改修方針: 射撃練習モードをTPS向けに改修
</result>
</attempt_completion>
```

### 外部への送信禁止

```yaml:no-remote-code.yaml
version: 1
rules:
  - description: "外部へのコード送信を禁止"
    include: []
    exclude:
      - "**"
```

### Initialize memory bankが一生終わらない

- というかループしすぎていて推論ができていない感じがする。
    - Content Lengthを大きくしすぎたせい？
    - PJ規模が大きすぎるとうまく学習できないかも
        - モデルとスペックが不足しているか
- Content Lengthをデフォルトに戻し、メモリバンクは諦めて1発でやりたいことを聞いてみる
    - ClineMemoryBankのルールは残しておく
        - 12593 tokensと言われたのでルールも消す
            - 消しても11773 tokensは使う
            - 13000に設定してみる

```md
まずはこのコードベースを理解してください。
LyraStarterGameディレクトリのサンプルゲームを流用してSHOOTER GYM/CONTROLを改修していく予定なので、特にその周辺をよく読み込んでください。
```

- 処理が終わらないし良い方向に向かっていない
    - コード全体を理解させて修正箇所を探すのは人力の方がよいかもしれない


## UE5-MCPを触ってみる

- https://www.youtube.com/watch?v=ct5dNJC-Hx4
- https://github.com/flopperam/unreal-engine-mcp
    - cp -r UnrealMCP/ YourProject/Plugins/
    - Edit → Plugins → Search "UnrealMCP" → Enable → Restart Editor
    - cd Python
    - uv run unreal_mcp_server_advanced.py
        - sudo snap install astral-uv
            - python3 -m pip install uv
        - パフォーマンスが落ちると言われるのでオプションを変更
            - python3 -m uv run --link-mode=copy unreal_mcp_server_advanced.py

```txt
- 前提：LyraStarterGame/Plugins/UnrealMCPやunreal-engine-mcpにMCPのソースを配備した
- 問題：ClineがMCP error -32000: Connection closedとなる

- [] cline_mcp_settings.jsonを適切に設定せよ
- [] unreal_mcp_server_advanced.pyでサーバを起動せよ
- [] MCPに接続せよ
```

```json:失敗したMCP設定
{
  "mcpServers": {
    "unrealMCP": {
      "disabled": false,
      "timeout": 60,
      "type": "stdio",
      "command": "uv",
      "args": [
        "--directory",
        "C:\\UnrealEngine\\unreal-engine-mcp\\Python",
        "run",
        "unreal_mcp_server_advanced.py"
      ]
    }
  }
}
```


## clineにmcpの導入方法を聞いてみる

```md
cmd /c "cd /d c:\UnrealEngine\unreal-engine-mcp\Python & .venv\Scripts\python -m ensurepip --upgrade & .venv\Scripts\python -m pip install -U pip setuptools wheel & .venv\Scripts\python -m pip install -e ."

設定内容:

- ファイル: c:/UnrealEngine/cline_mcp_settings.json
- 内容:

```json
// JSON
{
  "mcpServers": {
    "unreal-mcp-advanced": {
      "command": "c:/UnrealEngine/unreal-engine-mcp/Python/.venv/Scripts/python.exe",
      "args": [
        "-u",
        "c:/UnrealEngine/unreal-engine-mcp/Python/unreal_mcp_server_advanced.py"
      ],
      "env": { "PYTHONUNBUFFERED": "1" },
      "alwaysAllow": [],
      "disabled": false
    }
  }
}
```

サーバ起動/接続手順（Cline側操作）:

1. VS Code の Cline パネル → MCP Servers → Installed を開く

2. 「unreal-mcp-advanced」を有効化し「Restart」を押下（Cline が子プロセスとして STDIO で起動）

3. ツール一覧に `create_town`, `construct_house`, `create_castle_fortress` などが表示されれば接続完了

4. もし「MCP error -32000: Connection closed」が続く場合は次を確認:

   - `command` が venv の python.exe を指しているか
   - `args` に `-u` があるか（アンバッファ）
   - Unreal 側の 127.0.0.1:55557 が未起動でもサーバは稼働（ログに警告）。必要に応じて Unreal の受け口を起動
   - ログ: c:/UnrealEngine/unreal-engine-mcp/Python/unreal_mcp_advanced.log を確認

これで

- [x] cline_mcp_settings.json の適切な設定
- [x] unreal_mcp_server_advanced.py のサーバ起動準備（Cline 経由で起動）
- [x] MCP 接続（Cline の Restart 後に確立） を満たす構成となった。


